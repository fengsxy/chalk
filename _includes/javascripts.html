{% unless site.local_fonts %}
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Cormorant Garamond:700', 'Lato:300,400,700']
      }
    });
  </script>
{% endunless %}

{% if site.ga_analytics %}
  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','{{ site.ga_analytics }}','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>
{% endif %}

{% javascript vendor %}
{% javascript application %}
<script>
(function () {
  function applyLanguage(lang, sections) {
    var visible = 0;
    for (var i = 0; i < sections.length; i++) {
      var node = sections[i];
      var match = node.getAttribute('data-lang') || '';
      var isTarget = match === lang;
      node.style.display = isTarget ? '' : 'none';
      if (isTarget) {
        visible++;
      }
    }
    if (visible === 0) {
      for (var j = 0; j < sections.length; j++) {
        sections[j].style.display = '';
      }
      return false;
    }
    document.documentElement.setAttribute('lang', lang);
    return true;
  }

  function run() {
    var sections = document.querySelectorAll('[data-lang]');
    if (!sections.length) {
      return;
    }
    var pref = (navigator.language || navigator.userLanguage || '').toLowerCase();
    var targetLang = pref.indexOf('zh') === 0 ? 'zh' : 'en';
    if (!applyLanguage(targetLang, sections)) {
      var fallback = sections[0].getAttribute('data-lang') || 'en';
      applyLanguage(fallback, sections);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', run);
  } else {
    run();
  }
})();
</script>
